import{B as S,r as d,j as e,u as M}from"./index-DWozRySs.js";import{d as $}from"./Add-Dr9dGiqU.js";import{d as Q}from"./Search-C4KAhZ05.js";import{d as X}from"./MoreVert-BAiDkQyM.js";import{a as z}from"./instance-DZS3_tzi.js";import{a as E}from"./AxiosConfigHeader-CNHt4vQr.js";import{I as Y}from"./IconButton-BfZGExQz.js";import{P as Z}from"./Select-D4jnfiOn.js";import{M as L}from"./MenuItem-0gOXkRvp.js";import{d as H}from"./Close-CfBsvzH5.js";import{d as V}from"./CloudUpload-Oc61WHRU.js";import{F}from"./FetchApiBlog-UywPg9Wp.js";import{D as _,U as R}from"./DeleteImage-CrAdMm-9.js";import{s as W}from"./styled-BUrYsluB.js";import{m as q}from"./motion-CV68TVvv.js";import{T as I}from"./TextField-DV5y66jx.js";import{B}from"./Button-Bcful5Tm.js";import{d as k}from"./ExpandMore-s-773MFA.js";import{A,a as P,b as T}from"./AccordionSummary-f47a2KWv.js";import{I as ee}from"./InputAdornment-DV9jsepP.js";import{S as se}from"./Stack-DtaVED0n.js";import{P as ie}from"./Pagination-Du-v59ex.js";import"./createSvgIcon-e-FyxzSc.js";import"./createSvgIcon-C8KhxkLT.js";import"./useId-C5pU6Ksv.js";import"./useIsFocusVisible-CWAIqHst.js";import"./useControlled-DIh20Rar.js";import"./ButtonBase-ztTdquOL.js";import"./mergeSlotProps-BDZQvIdA.js";import"./index-DBJAgiAh.js";import"./Grow-Bh_FwPu_.js";import"./Typography-BBIY9fNW.js";const te=async s=>{var c,h;try{const l=await z.delete("/Blog",{axiosConfigHeader:E,params:{id:s}});console.log(">>>Delete success",l),(l==null?void 0:l.status)==200&&S.success("Deleted successfully")}catch(l){console.log(">>>Api delete Blog: ",(c=l==null?void 0:l.response)==null?void 0:c.data),((h=l==null?void 0:l.response)==null?void 0:h.data)=="Cannot delete this item because it is referenced by another entity"&&S.error("Data in use cannot be deleted")}};function ne({data:s,setIsOpenUpdatePopup:c,setItemUpdate:h,isDelete:l,setIsDelete:m}){var u;const[i,p]=d.useState(null),g=f=>{p(f.currentTarget)},n=()=>{p(null)},j=async()=>{let f=s==null?void 0:s.blogId;await te(f)},b=()=>{j(),n(),m(!l)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-8 gap-x-20 py-4 px-16 border-t border-solid border-gray-300 cursor-pointer my-4",children:[e.jsx("div",{className:"flex items-center col-span-2",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug",children:s==null?void 0:s.title})}),e.jsx("div",{className:"flex items-center col-span-3",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.description})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.image})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug",children:(u=s==null?void 0:s.manager)==null?void 0:u.username})}),e.jsx("div",{className:"flex items-center justify-center col-span-1",children:e.jsx(Y,{onClick:g,children:e.jsx(X,{})})})]}),e.jsxs(Z,{open:!!i,anchorEl:i,onClose:n,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsx(L,{onClick:()=>{c(!0),h(s),n()},children:"Update Blog"}),e.jsx(L,{onClick:b,sx:{color:"error.main"},children:"Delete"})]})]})}const le=async({formData:s})=>{try{return(await z.post("/Blog",s,E)).data}catch(c){console.log(">>> Api Create Blog Error: ",c)}};function re({setIsOpenPopup:s}){const c="Design3D",{UserId:h}=M(),[l,m]=d.useState([]);d.useEffect(()=>{(async()=>{const a=await F({});m(a)})()},[]);const[i,p]=d.useState({title:"",description:"",image:"",managerId:h}),g=(t,a)=>a.some(r=>r.title==t.title&&r.description==t.description&&r.image==t.image),[n,j]=d.useState({title:"",description:"",image:""}),b=t=>{const{name:a,value:r}=t.target;let v="",w=!0;try{if(a=="description"||a=="title"){v="This field cannot be blank";const N=Number(r);!isNaN(N)&&r!==""&&(v="This field cannot a number"),r!==""&&isNaN(N)&&(w=!1)}}catch{w=!0}p({...i,[a]:r}),j({...n,[a]:w?v:""})};console.log(i);const u=()=>{let t=!0,a={};console.log(n),Object.keys(n).forEach(r=>{n[r]!==""&&(t=!1)}),Object.keys(i).forEach(r=>{i[r]===""&&(a[r]="This field cannot be blank",t=!1)}),j(a),i.title!==""&&i.description!==""&&i.image!==""&&i.managerId!==""&&g(i,l)&&(t=!1,S.error("Blog Already Exists")),console.log(">>> Check success: ",t),t&&((async()=>await le({formData:i}))(),S.success("Create Success"),s(!1))},f=W("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),o=async t=>{const a=t.target.files[0];if(a){i.image!==""&&await _(i.image);let r=await R(c,a);console.log(r),p({...i,image:r})}};return console.log(i),e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>s(!1),className:"fixed top-0 right-0 left-0 bottom-0 bg-[rgba(0,0,0,0.6)] flex items-center justify-center",children:e.jsxs(q.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1,transition:{duration:.5}},onClick:t=>t.stopPropagation(),className:"bg-[#fff] w-[40rem] rounded-[10px] min-h-[450px]",children:[e.jsxs("div",{className:"relative text-center border-b-[1px] border-solid border-[#333] px-[1rem] py-[1rem] ",children:[e.jsx("h1",{className:"font-bold leading-5 text-[1.5rem]",children:"Add New Blog"}),e.jsx("div",{onClick:()=>s(!1),className:"absolute top-[10px] right-[10px] cursor-pointer",children:e.jsx(H,{})})]}),e.jsxs("div",{className:"px-[1rem] py-[1rem]",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"w-[100%]",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Title"}),e.jsx("div",{children:e.jsx(I,{name:"title",onChange:b,error:!!n.title,helperText:n==null?void 0:n.title,style:{width:"100%"},placeholder:"Title",id:"outlined-basic",variant:"outlined",size:"small",sx:{minHeight:"4rem"}})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Description"}),e.jsx("div",{children:e.jsx(I,{name:"description",onChange:b,error:!!n.description,helperText:n==null?void 0:n.description,fullWidth:!0,placeholder:"description",id:"outlined-basic",variant:"outlined",size:"medium",sx:{minHeight:"4rem"},multiline:!0,rows:4})})]}),e.jsx("div",{children:e.jsx("div",{className:"w-80 mt-5",children:e.jsxs(B,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,startIcon:e.jsx(V,{}),sx:{border:"2px solid",color:`${i.image==""?"red":"green"}`},onChange:o,children:["Upload Blog Image",e.jsx(f,{type:"file"})]})})})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsxs(B,{onClick:u,variant:"contained",sx:{minWidth:"6rem"},children:[e.jsx($,{fontSize:"small",sx:{marginRight:"8px"}}),"Add"]})})]})]})})})}const oe=async({id:s,formData:c})=>{try{return(await z.put(`/Blog?id=${s}`,c,E)).data}catch(h){console.log(">>> Api Update Blog ",h)}};function ae({data:s,setIsOpenUpdatePopup:c}){const h="Design3D",{UserId:l}=M(),[m,i]=d.useState({title:"",description:"",image:""}),[p,g]=d.useState({title:"",description:""}),n=o=>{const{name:t,value:a}=o.target;i({...m,[t]:a}),g({...p,[t]:""})},j=W("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),b=async o=>{const t=o.target.files[0];if(t){m.image!==""&&m.image!=null&&await _(m.image);let a=await R(h,t);i({...m,image:a,managerId:l})}},u=()=>{const o={title:"",description:""};return m.title||(o.title="Title cannot be empty"),m.description||(o.description="Description cannot be empty"),g(o),!o.title&&!o.description},f=()=>{if(u()){let o=s==null?void 0:s.blogId;(async()=>{await oe({id:o,formData:m})})(),S.success("Create Success"),c(!1),console.log("Updating with data:",m)}else console.log("Form validation failed")};return e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>c(!1),className:"fixed top-0 right-0 left-0 bottom-0 bg-[rgba(0,0,0,0.6)] flex items-center justify-center",children:e.jsxs(q.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1,transition:{duration:.5}},onClick:o=>o.stopPropagation(),className:"bg-[#fff] w-[30rem] rounded-[10px] min-h-[250px]",children:[e.jsxs("div",{className:"relative text-center border-b-[1px] border-solid border-[#333] px-[1rem] py-[1rem] ",children:[e.jsx("h1",{className:"font-bold leading-5 text-[1.5rem]",children:"Update Blog"}),e.jsx("div",{onClick:()=>c(!1),className:"absolute top-[10px] right-[10px] cursor-pointer",children:e.jsx(H,{})})]}),e.jsxs(A,{children:[e.jsx(P,{expandIcon:e.jsx(k,{}),children:e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Old Image"})}),e.jsx(T,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s==null?void 0:s.image,alt:"Current Blog Image",className:"max-w-full max-h-[10rem] object-cover"})})})]}),e.jsxs(A,{children:[e.jsx(P,{expandIcon:e.jsx(k,{}),children:e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Old Title"})}),e.jsx(T,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"w-[90%] text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.title})})})]}),e.jsxs(A,{children:[e.jsx(P,{expandIcon:e.jsx(k,{}),children:e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Old Description"})}),e.jsx(T,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"w-[90%] text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.description})})})]}),e.jsxs("div",{className:"px-[1rem] py-[1rem]",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"w-[100%]",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"New Title"}),e.jsx("div",{children:e.jsx(I,{name:"title",onChange:n,error:!!p.title,helperText:p==null?void 0:p.title,style:{width:"100%"},placeholder:"New Title",id:"outlined-basic",variant:"outlined",size:"small",sx:{minHeight:"4rem"}})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"New Description"}),e.jsx("div",{children:e.jsx(I,{name:"description",onChange:n,error:!!p.description,helperText:p==null?void 0:p.description,fullWidth:!0,placeholder:"New Description",id:"outlined-basic",variant:"outlined",size:"medium",sx:{minHeight:"4rem"},multiline:!0,rows:4})})]}),e.jsx("div",{children:e.jsx("div",{className:"w-80 mt-5",children:e.jsxs(B,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,startIcon:e.jsx(V,{}),sx:{border:"2px solid",color:`${m.image==""?"red":"green"}`},onChange:b,children:["Upload Blog Image",e.jsx(j,{type:"file"})]})})})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsx(B,{onClick:f,variant:"contained",sx:{minWidth:"6rem"},children:"Update"})})]})]})})})}function He(){const[c,h]=d.useState(!1),[l,m]=d.useState([]),[i,p]=d.useState(""),[g,n]=d.useState(!1),[j,b]=d.useState(),[u,f]=d.useState(!1),[o,t]=d.useState(1),[a,r]=d.useState(0),[v,w]=d.useState(1),N=async()=>{const x=await F({pageSize:6,page:v});m(x)},U=async()=>{const x=await F({});return r(x==null?void 0:x.length),x};d.useEffect(()=>{i===""&&N(),U()},[c,v,g,u]),d.useEffect(()=>{let x=[];i===""&&(w(1),N()),(async()=>{x=await U(),console.log(x);const D=x.filter(y=>{var O;return y.title.toLowerCase().includes(i.toLowerCase())||y.description.toString().toLowerCase().includes(i.toLowerCase())||y.image.toString().toLowerCase().includes(i.toLowerCase())||((O=y==null?void 0:y.manager)==null?void 0:O.username.toLowerCase().includes(i.toLowerCase()))}),K=D.slice((o-1)*6,o*6);m(K),r(D==null?void 0:D.length)})()},[i,o,g,u]);const G=(x,C)=>{i===""?w(C):t(C)},J=x=>{p(x.target.value),t(1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-[100vh] py-[3rem] px-[3rem] bg-[#f7f9fc]",children:[e.jsx("div",{className:"w-[100%] min-h-[600px]",children:e.jsxs("div",{className:"rounded-[30px] border-[1px] border-solid border-[#e9eaf3] bg-[white]",children:[e.jsxs("div",{className:"py-[1.75rem] px-[2.25rem] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center ",children:[e.jsx("h2",{className:"mr-5 font-bold text-[1.5rem] leading-[1.125em]",children:"All Blog"}),e.jsx(I,{onChange:J,value:i,id:"outlined-basic",placeholder:"Search...",variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px"},"& .MuiOutlinedInput-notchedOutline":{borderRadius:"30px"}},InputProps:{startAdornment:e.jsx(ee,{position:"start",children:e.jsx(Q,{})})}})]}),e.jsx(B,{onClick:()=>h(!0),startIcon:e.jsx($,{}),variant:"contained",children:"New Blog"})]}),e.jsxs("div",{className:"bg-gray-100 grid grid-cols-8 gap-x-20 py-4 px-16 border-t border-solid border-gray-300",children:[e.jsx("div",{className:"flex items-center col-span-2",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Title"})}),e.jsx("div",{className:"flex items-center col-span-3",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Description"})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Image"})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Manager"})})]}),l==null?void 0:l.map((x,C)=>e.jsx(ne,{data:x,setIsOpenUpdatePopup:n,setItemUpdate:b,isDelete:u,setIsDelete:f},C))]})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(se,{children:e.jsx(ie,{count:Math.ceil(a/6)||0,page:i===""?v:o,onChange:G})})})]}),c&&e.jsx(re,{setIsOpenPopup:h}),g&&e.jsx(ae,{setIsOpenUpdatePopup:n,data:j})]})}export{He as default};
