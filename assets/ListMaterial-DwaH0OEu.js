import{B as w,r as m,j as e,u as U}from"./index-DWozRySs.js";import{d as z}from"./Add-Dr9dGiqU.js";import{d as W}from"./Search-C4KAhZ05.js";import{d as q}from"./MoreVert-BAiDkQyM.js";import{a as k}from"./instance-DZS3_tzi.js";import{a as P}from"./AxiosConfigHeader-CNHt4vQr.js";import{F as G}from"./FetchApiMaterial-DZe9b-Kv.js";import{I as J}from"./IconButton-BfZGExQz.js";import{P as K}from"./Select-D4jnfiOn.js";import{M as E}from"./MenuItem-0gOXkRvp.js";import{d as T}from"./Close-CfBsvzH5.js";import{d as O}from"./CloudUpload-Oc61WHRU.js";import{D as $,U as H}from"./DeleteImage-CrAdMm-9.js";import{s as B}from"./styled-BUrYsluB.js";import{m as V}from"./motion-CV68TVvv.js";import{T as S}from"./TextField-DV5y66jx.js";import{B as I}from"./Button-Bcful5Tm.js";import{d as Q}from"./ExpandMore-s-773MFA.js";import{A as X,a as Y,b as Z}from"./AccordionSummary-f47a2KWv.js";import{I as ee}from"./InputAdornment-DV9jsepP.js";import{S as se}from"./Stack-DtaVED0n.js";import{P as ie}from"./Pagination-Du-v59ex.js";import"./createSvgIcon-e-FyxzSc.js";import"./createSvgIcon-C8KhxkLT.js";import"./useId-C5pU6Ksv.js";import"./useIsFocusVisible-CWAIqHst.js";import"./useControlled-DIh20Rar.js";import"./ButtonBase-ztTdquOL.js";import"./mergeSlotProps-BDZQvIdA.js";import"./index-DBJAgiAh.js";import"./Grow-Bh_FwPu_.js";import"./Typography-BBIY9fNW.js";const te=async s=>{var c,p;try{const r=await k.delete("/Material",{axiosConfigHeader:P,params:{id:s}});console.log(">>>Delete success",r),(r==null?void 0:r.status)==200&&w.success("Deleted successfully")}catch(r){console.log(">>>Api delete Material: ",(c=r==null?void 0:r.response)==null?void 0:c.data),((p=r==null?void 0:r.response)==null?void 0:p.data)=="Cannot delete this item because it is referenced by another entity"&&w.error("Data in use cannot be deleted")}};function ae({data:s,setIsOpenUpdatePopup:c,setItemUpdate:p,isDelete:r,setIsDelete:d}){const[t,x]=m.useState(null),[g,o]=m.useState(),N=i=>{x(i.currentTarget)},f=()=>{x(null)},j=async()=>{let i=s==null?void 0:s.materialId;await te(i)||w.error("Exists Design")},v=async()=>{const i=await G();o(i)};m.useEffect(()=>{v()},[]);const a=()=>{j(),f(),d(!r)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-8 gap-x-10 py-4 px-16 border-t border-solid border-gray-300 cursor-pointer my-4",children:[e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug",children:s==null?void 0:s.materialId})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.name})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.price})}),e.jsx("div",{className:"flex items-center col-span-3",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.image})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-sm font-medium tracking-wide leading-snug",children:s==null?void 0:s.managerId})}),e.jsx("div",{className:"flex items-center justify-center col-span-1",children:e.jsx(J,{onClick:N,children:e.jsx(q,{})})})]}),e.jsxs(K,{open:!!t,anchorEl:t,onClose:f,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsx(E,{onClick:()=>{c(!0),p(s),f()},children:"Update Material"}),e.jsx(E,{onClick:a,sx:{color:"error.main"},children:"Delete"})]})]})}const ne=async({formData:s})=>{try{return(await k.post("/Material",s,P)).data}catch(c){console.log(">>> Api Create Material Error: ",c)}},A=async({pageSize:s,page:c})=>{try{return(await k.get("/Material",{headers:{...P},params:{pageIndex:c,pageSize:s}})).data}catch(p){return console.error(p),[]}};function re({setIsOpenPopup:s}){const c="Material",{UserId:p}=U(),[r,d]=m.useState([]);m.useEffect(()=>{(async()=>{const l=await A({});d(l)})()},[]);const[t,x]=m.useState({name:"",price:"",image:"",managerId:p}),g=(i,l)=>l.some(n=>n.name==i.name&&n.price==i.price&&n.image==i.image),[o,N]=m.useState({name:"",price:"",image:""}),f=i=>{const{name:l,value:n}=i.target;let b="",u=!0;try{if(l==="name"&&(b="This field cannot be blank",n===""?u=!0:isNaN(Number(n))?u=!1:(b="This field cannot contain a number",u=!0)),l==="price"){b="This field cannot be blank";const y=Number(n);n===""?u=!0:isNaN(y)?(b="This field must be a number",u=!0):u=!1}}catch{u=!0}x({...t,[l]:n}),N({...o,[l]:u?b:""})};console.log(t);const j=()=>{let i=!0,l={};console.log(o),Object.keys(o).forEach(n=>{o[n]!==""&&(i=!1)}),Object.keys(t).forEach(n=>{t[n]===""&&(l[n]="This field cannot be blank",i=!1)}),N(l),t.name!==""&&t.price!==""&&t.image!==""&&t.managerId!==""&&g(t,r)&&(i=!1,w.error("Material Already Exists")),console.log(">>> Check success: ",i),i&&((async()=>await ne({formData:t}))(),w.success("Create Success"),s(!1))},v=B("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),a=async i=>{const l=i.target.files[0];if(l){t.image!==""&&await $(t.image);let n=await H(c,l);console.log(n),x({...t,image:n})}};return e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>s(!1),className:"fixed top-0 right-0 left-0 bottom-0 bg-[rgba(0,0,0,0.6)] flex items-center justify-center",children:e.jsxs(V.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1,transition:{duration:.5}},onClick:i=>i.stopPropagation(),className:"bg-[#fff] w-[40rem] rounded-[10px] min-h-[450px]",children:[e.jsxs("div",{className:"relative text-center border-b-[1px] border-solid border-[#333] px-[1rem] py-[1rem] ",children:[e.jsx("h1",{className:"font-bold leading-5 text-[1.5rem]",children:"Add New Material"}),e.jsx("div",{onClick:()=>s(!1),className:"absolute top-[10px] right-[10px] cursor-pointer",children:e.jsx(T,{})})]}),e.jsxs("div",{className:"px-[1rem] py-[1rem]",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"w-[100%]",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Name"}),e.jsx("div",{children:e.jsx(S,{name:"name",onChange:f,error:!!o.name,helperText:o==null?void 0:o.name,style:{width:"100%"},placeholder:"Name Material",id:"outlined-basic",variant:"outlined",size:"small",sx:{minHeight:"4rem"}})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Price"}),e.jsx("div",{children:e.jsx(S,{name:"price",onChange:f,error:!!o.price,helperText:o==null?void 0:o.price,fullWidth:!0,placeholder:"Price",id:"outlined-basic",variant:"outlined",size:"medium",sx:{minHeight:"4rem"}})})]}),e.jsx("div",{children:e.jsx("div",{className:"w-80 mt-5",children:e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,startIcon:e.jsx(O,{}),sx:{border:"2px solid",color:`${t.image==""?"red":"green"}`},onChange:a,children:["Upload Material Image",e.jsx(v,{type:"file"})]})})})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsxs(I,{onClick:j,variant:"contained",sx:{minWidth:"6rem"},children:[e.jsx(z,{fontSize:"small",sx:{marginRight:"8px"}}),"Add"]})})]})]})})})}const le=async({id:s,formData:c})=>{try{return(await k.put(`/Material?id=${s}`,c,P)).data}catch(p){console.log(">>> Api Update Material ",p)}};function ce({data:s,setIsOpenUpdatePopup:c}){const p="Material",{UserId:r}=U(),[d,t]=m.useState({name:"",price:"",image:""}),[x,g]=m.useState({name:"",price:""}),o=a=>{const{name:i,value:l}=a.target;t({...d,[i]:l}),g({...x,[i]:""})},N=B("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),f=async a=>{const i=a.target.files[0];if(i){d.image!==""&&d.image!=null&&await $(d.image);let l=await H(p,i);t({...d,image:l,managerId:r})}},j=()=>{const a={name:"",price:""};return d.name||(a.name="name cannot be empty"),d.price?isNaN(Number(d.price))&&(a.price="Price must be a number"):a.price="Price cannot be empty",g(a),!a.name&&!a.price},v=()=>{if(j()){let a=s==null?void 0:s.materialId;(async()=>{await le({id:a,formData:d})})(),w.success("Update Success"),c(!1),console.log("Updating with data:",d)}else console.log("Form validation failed")};return e.jsx(e.Fragment,{children:e.jsx("div",{onClick:()=>c(!1),className:"fixed top-0 right-0 left-0 bottom-0 bg-[rgba(0,0,0,0.6)] flex items-center justify-center",children:e.jsxs(V.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1,transition:{duration:.5}},onClick:a=>a.stopPropagation(),className:"bg-[#fff] w-[30rem] rounded-[10px] min-h-[250px]",children:[e.jsxs("div",{className:"relative text-center border-b-[1px] border-solid border-[#333] px-[1rem] py-[1rem] ",children:[e.jsx("h1",{className:"font-bold leading-5 text-[1.5rem]",children:"Update Material"}),e.jsx("div",{onClick:()=>c(!1),className:"absolute top-[10px] right-[10px] cursor-pointer",children:e.jsx(T,{})})]}),e.jsxs(X,{children:[e.jsx(Y,{expandIcon:e.jsx(Q,{}),children:e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"Material Detail"})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[1rem] font-medium pb-[2px]",children:"Old Image"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s==null?void 0:s.image,alt:"Current Blog Image",className:"max-w-[80%] max-h-[10rem] object-cover"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[1rem] font-medium pb-[2px]",children:"Old Name"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"w-[90%] text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.name})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[1rem] font-medium pb-[2px]",children:"Old Price"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"w-[90%] text-sm font-medium tracking-wide leading-snug overflow-hidden text-ellipsis line-clamp-2",children:s==null?void 0:s.price})})]})]})]}),e.jsxs("div",{className:"px-[1rem] py-[1rem]",children:[e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"w-[100%]",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"New Name"}),e.jsx("div",{children:e.jsx(S,{name:"name",onChange:o,error:!!x.name,helperText:x==null?void 0:x.name,style:{width:"100%"},placeholder:"New Name",id:"outlined-basic",variant:"outlined",size:"small",sx:{minHeight:"4rem"}})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-[1.1rem] font-medium pb-[3px]",children:"New Price"}),e.jsx("div",{children:e.jsx(S,{name:"price",onChange:o,error:!!x.price,helperText:x==null?void 0:x.price,fullWidth:!0,placeholder:"New Price",id:"outlined-basic",variant:"outlined",size:"medium",sx:{minHeight:"4rem"}})})]}),e.jsx("div",{children:e.jsx("div",{className:"w-80 mt-5",children:e.jsxs(I,{component:"label",role:void 0,variant:"outlined",tabIndex:-1,startIcon:e.jsx(O,{}),sx:{border:"2px solid",color:`${d.image==""?"red":"green"}`},onChange:f,children:["Upload Material Image",e.jsx(N,{type:"file"})]})})})]}),e.jsx("div",{className:"mt-[1rem]",children:e.jsx(I,{onClick:v,variant:"contained",sx:{minWidth:"6rem"},children:"Update"})})]})]})})})}function Ve(){const[c,p]=m.useState(!1),[r,d]=m.useState([]),[t,x]=m.useState(""),[g,o]=m.useState(!1),[N,f]=m.useState(),[j,v]=m.useState(!1),[a,i]=m.useState(1),[l,n]=m.useState(0),[b,u]=m.useState(1),y=async()=>{const h=await A({pageSize:6,page:b});d(h)},D=async()=>{const h=await A({});return n(h==null?void 0:h.length),h};m.useEffect(()=>{t===""&&y(),D()},[c,b,g,j]),m.useEffect(()=>{let h=[];t===""&&(u(1),y()),(async()=>{h=await D(),console.log(t);const M=h.filter(F=>String(F.materialId).toLowerCase().includes(t.toLowerCase())||String(F.name).toLowerCase().includes(t.toLowerCase()));console.log(M);const R=M.slice((a-1)*6,a*6);d(R),n(M==null?void 0:M.length)})()},[t,a,g,j]);const _=(h,C)=>{t===""?u(C):i(C)},L=h=>{x(h.target.value),i(1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-[100vh] py-[3rem] px-[3rem] bg-[#f7f9fc]",children:[e.jsx("div",{className:"w-[100%] min-h-[600px]",children:e.jsxs("div",{className:"rounded-[30px] border-[1px] border-solid border-[#e9eaf3] bg-[white]",children:[e.jsxs("div",{className:"py-[1.75rem] px-[2.25rem] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center ",children:[e.jsx("h2",{className:"mr-5 font-bold text-[1.5rem] leading-[1.125em]",children:"All Material"}),e.jsx(S,{onChange:L,value:t,id:"outlined-basic",placeholder:"Search...",variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:"30px"},"& .MuiOutlinedInput-notchedOutline":{borderRadius:"30px"}},InputProps:{startAdornment:e.jsx(ee,{position:"start",children:e.jsx(W,{})})}})]}),e.jsx(I,{onClick:()=>p(!0),startIcon:e.jsx(z,{}),variant:"contained",children:"New Material"})]}),e.jsxs("div",{className:"grid grid-cols-8 gap-x-10 py-4 px-16 border-t border-solid border-gray-300 cursor-pointer my-4",children:[e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"materialId"})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Name"})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"Price"})}),e.jsx("div",{className:"flex items-center col-span-3",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"image"})}),e.jsx("div",{className:"flex items-center col-span-1",children:e.jsx("h2",{className:"text-base font-medium tracking-wide leading-snug",children:"managerId"})})]}),r==null?void 0:r.map((h,C)=>e.jsx(ae,{data:h,setIsOpenUpdatePopup:o,setItemUpdate:f,isDelete:j,setIsDelete:v},C))]})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(se,{children:e.jsx(ie,{count:Math.ceil(l/6)||0,page:t===""?b:a,onChange:_})})})]}),c&&e.jsx(re,{setIsOpenPopup:p}),g&&e.jsx(ce,{setIsOpenUpdatePopup:o,data:N})]})}export{Ve as default};
